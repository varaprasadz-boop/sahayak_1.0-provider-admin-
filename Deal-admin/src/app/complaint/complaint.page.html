<ion-header>
  <ion-toolbar color="primary">
    <ion-title> Complaint </ion-title>
    <ion-buttons slot="end">
      <ion-button fill="outline" color="light" routerLink="/add-complaint"
        >Add Complaint</ion-button
      >
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <div style="overflow-x: auto">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Complaint ID</th>
          <th>Booking ID</th>
          <th>Customer Name</th>
          <th>Complaint Raised Date</th>
          <th>Complaint End Date</th>
          <th>Complaint Details</th>
          <th>Agent Name</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of complaints">
          <td>{{item.complaintId}}</td>
          <td (click)="presentAlert(item)">
            <p style="color: blue; cursor: pointer; text-decoration: underline">{{item.srNo}}</p>
          </td>
          <td>{{item.customerName}}</td>
          <td>{{formatTimestamp(item.created_at)}}</td>
          <td>{{formatTimestamp(item.closeDate)}}</td>
          <td>{{item.complaintDetail}}</td>
          <td>{{item.agentName}}</td>
          <td>
            <ion-button
              fill="outline"
              [color]="getStatusColor('status', item.status)"
            >
              <ion-select
                [disabled]="item.status === 'close'"
                style="margin: 0px !important;opacity: 1;"
                aria-label="status"
                [(ngModel)]="item.status"
                (ionChange)="statusChanged(item)">
                <ion-select-option value="open">Open</ion-select-option>
                <ion-select-option value="close">Close</ion-select-option>
              </ion-select>
            </ion-button>
            <!-- <ion-button (click)="presentAlert(item)" fill="outline">
              <ion-icon name="eye"></ion-icon>
              View
            </ion-button> -->
            <ion-button (click)="presentAlert3(item)" fill="outline" *ngIf="item.status=='close'">
              <ion-icon name="eye"></ion-icon>
              View Comment
            </ion-button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <ion-button style="display: none;" id="open-modal" expand="block">Open</ion-button>
  <ion-modal trigger="open-modal" #modal backdropDismiss="false">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-buttons slot="start">
            <ion-button (click)="cancel()">Cancel</ion-button>
          </ion-buttons>
          <ion-title class="ion-text-center">Enter Solution Offered</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="confirm(offerComplaints)" [strong]="true">Submit</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>
          <ion-item lines="none" style="border: 1px solid rgb(175, 175, 175);border-radius: 10px;">
            <ion-textarea style="height: 350px;" placeholder="Enter Solution Offered" [(ngModel)]="this.offerComplaints.solutionOffered"></ion-textarea>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-button style="display: none;" id="open-modal2" expand="block">Open</ion-button>
  <ion-modal trigger="open-modal2" #modal2>
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-buttons slot="start">
            <ion-button (click)="modal2.dismiss()">Cancel</ion-button>
          </ion-buttons>
          <ion-title class="ion-text-center">Booking Details</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
         <ion-card *ngFor="let booking of selectedBookings">
          <div class="ion-text-center">
          <img style="height:150px;width: 150px;" [src]="booking.service.image" alt="">
        </div>
          <ion-row>
            <ion-col>
              <ion-card-header>
                <ion-card-title>{{booking.service.name}}</ion-card-title>
              </ion-card-header>
              <ion-card-content>
            <ion-item>
                <ion-label>
                  <h2>Booking ID</h2>
                </ion-label>
                <ion-label slot="end">
                  <h2>{{booking.bookingId}}</h2>
                </ion-label>
            </ion-item>
            <ion-item>
              <ion-label>
                <h2>Customer Name</h2>
              </ion-label>
              <ion-label slot="end">
                <h2>{{getCustomerNameStore(booking.uid)}}</h2>
              </ion-label>
          </ion-item>
            <ion-item>
              <ion-label>
                <h2>Status</h2>
              </ion-label>
              <ion-label slot="end">
                <h2><ion-chip [color]="booking.service.status=='active'?'success':'warning' ">{{booking.service.status|titlecase}}</ion-chip> </h2>
              </ion-label>
          </ion-item>
          <ion-item>
              <ion-label>
                <h2>Agent Status</h2>
              </ion-label>
              <ion-label slot="end">
                <h2><ion-chip [color]="booking.agentStatus=='assigned'?'success':'warning' "> {{booking.agentStatus|titlecase}}</ion-chip></h2>
              </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>Service Provider Name</h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{getServiceProviderNameStore(booking.agentId)}}</h2>
            </ion-label>
        </ion-item>
          <ion-item>
            <ion-label>
              <h2>Booking Status</h2>
            </ion-label>
            <ion-label slot="end">
              <h2><ion-chip [color]="booking.bookingStatus=='confirm'?'success':'warning' "> {{booking.bookingStatus|titlecase}}</ion-chip></h2>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>Job Status</h2>
            </ion-label>
            <ion-label slot="end">
              <h2><ion-chip [color]="booking.jobStatus=='completed'?'success':'warning' ">{{booking.jobStatus|titlecase}}</ion-chip></h2>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>Payment Status</h2>
            </ion-label>
            <ion-label slot="end">
              <h2><ion-chip [color]="booking.paymentStatus=='pending'?'warning':'success' ">{{booking.paymentStatus|titlecase}}</ion-chip></h2>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>Date</h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{booking.schedule.date}}</h2>
            </ion-label>
        </ion-item>
          <ion-item>
            <ion-label>
              <h2>Booking Start Time</h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{booking.startedTime ? booking.startedTime : 'Not Started'}}</h2>
            </ion-label>
        </ion-item>
          <ion-item>
            <ion-label>
              <h2>Booking End Time</h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{booking.completedTime ? booking.completedTime : 'Not Completed'}}</h2>
            </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Time</h2>
          </ion-label>
          <ion-label slot="end">
            <h2>{{booking.schedule.time}}</h2>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Price</h2>
          </ion-label>
          <ion-label slot="end">
            <h2>INR {{booking.service.price}}</h2>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Description</h2>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>{{booking.service.description}}</h2>
          </ion-label>
        </ion-item>
              </ion-card-content>
            </ion-col>
          </ion-row>
        </ion-card> 
      </ion-content>
    </ng-template>
  </ion-modal>
  <ion-button style="display: none;" id="open-modal3" expand="block">Open</ion-button>
  <ion-modal trigger="open-modal3" #modal3>
    <ng-template>
      <ion-header>
        <ion-toolbar style="border: 1px solid;" color="primary">
          <ion-buttons slot="start">
            <ion-button  (click)="modal3.dismiss()">Close</ion-button>
          </ion-buttons>
          <ion-title class="ion-text-center">Solution Offered</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-label>
            <h2>Complaint ID</h2>
          </ion-label>
          <ion-label slot="end">
            <h2>{{this.viewComplaints.complaintId}}</h2>
          </ion-label>
        </ion-item>
        <ion-item>
          <ion-label>
            <h2>Complaint Raised By</h2>
          </ion-label>
          <ion-label slot="end">
            <h2>{{this.viewComplaints.agentName}}</h2>
          </ion-label>
        </ion-item>
        <ion-card>
          <ion-item>
            <ion-label>
              <h2>Complaint </h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{formatTimestamp(this.viewComplaints.created_at)}}</h2>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{this.viewComplaints.complaintDetail}}</h2>
            </ion-label>
          </ion-item>
        </ion-card>
        <ion-card>
          <ion-item>
            <ion-label>
              <h2>Complaint Solution Offer</h2>
            </ion-label>
            <ion-label slot="end">
              <h2>{{formatTimestamp(this.viewComplaints.closeDate)}}</h2>
            </ion-label>
          </ion-item>
          <ion-item>
            <ion-label>
              <h2>{{this.viewComplaints.solutionOffered}}</h2>
            </ion-label>
          </ion-item>
        </ion-card>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
